### Runbook for Swapmeet.
## This runbook assumes the following:
    * That the user has the Swapmeet Github repository cloned locally.
    * That the user has a Digital Ocean account, and the user has created a Droplet.  This droplet should use Ubuntu 20.04 (LTS) x64
    * That the user has created an SSH key somewhere on their computer, and that the SSH key is NOT BEING PUSHED TO THE REMOTE REPOSITORY.
    * Secure copy (scp) is installed on the user's computer.
    * A MongoDB has already been set up
## Task 1: Link the SSH key to the server.
1. From the Digital Ocean web application, select the Droplet that has been created for the Swapmeet web applcation.
2.  Select "Access" from the menu on the left side of the page.
3. Click "Launch Droplet Console" under the "Droplet Console" heading.  A console will open.
4. Type the following command to edit the SSH keys that are allowed for the server:
    ```nano .ssh/authorized_keys```.
5. Copy the contents of the public portion of the SSH key into the text editor displayed in the console.  Save the changes made to the authorized_keys file.  Close the text editor and return to the console.
6. The user should now be able to use their private SSH key to connect to the server.

## Task #2: Login to the server
1. Open up Windows PowerShell, or another shell of your choice on your PC.
2. In the shell, type ```ssh -i [path_to_key] root@[ip_server_address]```.  This will allow the user to run commands on the server.

## Task #3: Install ngnix and npm, among other packages
1. Type the command ``` sudo apt update ```
2. Type the command ```sudo apt install nginx```
3. nginx is now installed on the Droplet.
4. Type the command ```sudo apt-get install nodejs npm```
5. npm is now installed on the Droplet.
6. Type the command ```npm install```
7. Type the command ```npm install dotenv```
8. Type the command ```npm install -g n```
9. Type the command ```sudo n stable```
10. Type the command ```PATH = "$PATH"```
11. Type the command ```npm install mongoose```
12. Type the command ```npm install typescript```
13. All applicable packages are now installed.

## Task #4: Configure nginx
1. To configure nginx, type the command ```nano /etc/nginx/sites-available/default```.  A text editor pops up in the shell
2. Delete all content under ```server``` in the file.
3. To route the web application correctly, paste in the following code:
```
listen 80 default_server;
        listen [::]:80 default_server;

        # SSL configuration
        #
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        #
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        #
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        #
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        #
        # include snippets/snakeoil.conf;

        root /srv/dist;

        # Add index.php to the list if you are using PHP
        index index.html index.htm;

        server_name _;

        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                try_files $uri $uri/ =404;
        }
```
4. To correctly route the API for the server, paste in the following code
```
location /api {
                proxy_pass http://localhost:3030;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection 'upgrade';
                proxy_set_header Host $host;
                proxy_cache_bypass $http_upgrade;
        }
```
5. Type the command ```nginx -t && nginx -s reload```
6. nginx is now properly configured for the application

## Task #5: Upload the web application front end to the server
1. Navigate to /SwapMeet folder in the local Github repository mentioned in the prerequisites via a command shell.
2. Type ```npm run build``` to create a packaged web application.  This packaged web application will be stored in /SwapMeet/dist.
3. Type in the following command: ```scp -i [key_file_path] -r [swapmeet_file_path]\SwapMeet\dist root@[droplet_ip_address]:/srv```
4. The packaged web application is now in the folder /srv/dist

## Task #6: Upload the web application back end to the server
1. Navigate to /SwapMeet folder in the local Github repository mentioned in the prerequisites via a command shell.
2. Type in the following command: ```scp -i [key_file_path] -r [swapmeet_file_path]\SwapMeet\server root@[droplet_ip_address]:/srv```
3. The web application back end is now in the folder /srv/server

## Task #7: Install pm2
Prerequisite: Task 2 has been completed and the user is still logged into the server
1.  Type the command ```npm install pm2 -g``` from any file location on the server
2. pm2 is now installed globally on the server

## Task #8: Start the application
Prerequisite: Task 2 has been completed and the user is still logged into the server
1. Navigate to /srv/server
2. Type the command ```pm2 start index.js```
3. The application should now be running.